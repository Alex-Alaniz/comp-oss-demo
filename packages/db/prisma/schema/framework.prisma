

model OrganizationFramework {
  id                  String                @id @default(cuid())
  organizationId      String
  frameworkId         String
  status              FrameworkStatus       @default(not_started)
  adoptedAt           DateTime              @default(now())
  lastAssessed        DateTime?
  nextAssessment      DateTime?
  organizationControl OrganizationControl[]
  organization        Organization          @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([organizationId, frameworkId])
}

model FrameworkCategory {
  id          String    @id @default(cuid())
  name        String
  code        String    @unique
  description String?
  frameworkId String

  @@index([frameworkId])
}


model OrganizationControl {
  id                             String                           @id @default(cuid())
  organizationId                 String
  controlId                      String
  status                         ComplianceStatus                 @default(not_started)
  lastReviewDate                 DateTime?
  nextReviewDate                 DateTime?
  organizationFrameworkId        String?
  organizationCategoryId         String?
  OrganizationCategory           OrganizationCategory?            @relation(fields: [organizationCategoryId], references: [id])
  OrganizationFramework          OrganizationFramework?           @relation(fields: [organizationFrameworkId], references: [id])
  organization                   Organization                     @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  OrganizationControlRequirement OrganizationControlRequirement[]

  @@index([organizationId])
  @@index([organizationFrameworkId])
  @@index([controlId])
}



model OrganizationControlRequirement {
  id                    String          @id @default(cuid())
  organizationControlId String
  controlRequirementId  String
  content               Json?
  createdAt             DateTime        @default(now())
  description           String?
  fileUrl               String?
  published             Boolean         @default(false)
  type                  RequirementType
  updatedAt             DateTime        @updatedAt

  organizationPolicyId   String?
  organizationEvidenceId String?
  organizationControl    OrganizationControl   @relation(fields: [organizationControlId], references: [id], onDelete: Cascade)
  organizationEvidence   OrganizationEvidence? @relation(fields: [organizationEvidenceId], references: [id], onDelete: Cascade)
  organizationPolicy     OrganizationPolicy?   @relation(fields: [organizationPolicyId], references: [id], onDelete: Cascade)

  @@unique([organizationControlId, controlRequirementId])
}

model OrganizationCategory {
  id                  String                @id @unique @default(cuid())
  name                String
  description         String?
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt
  organizationId      String
  frameworkId         String
  organization        Organization          @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  organizationControl OrganizationControl[]

  @@index([organizationId])
}

model OrganizationEvidence {
  id              String       @id @unique @default(cuid())
  name            String
  description     String?
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  published       Boolean      @default(false)
  organizationId  String
  additionalUrls  String[]
  evidenceId      String
  fileUrls        String[]
  frequency       Frequency?
  lastPublishedAt DateTime?
  assigneeId      String?
  department      Departments? @default(none)
  isNotRelevant   Boolean      @default(false)

  frameworkId String

  OrganizationControlRequirement OrganizationControlRequirement[]
  assignee                       User?                            @relation(fields: [assigneeId], references: [id])
  organization                   Organization                     @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([organizationId])
  @@index([assigneeId])
}
